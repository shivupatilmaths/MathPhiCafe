{% extends 'base.html' %}
{% block title %}Messages - Admin{% endblock %}
{% block extra_css %}<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">{% endblock %}

{% block content %}
<div class="container-fluid" style="margin-top:76px">
    <div class="row">
        {% include 'admin/_sidebar.html' %}
        <div class="col-lg-10 admin-main">
            <div class="admin-page-header">
                <h2><i class="bi bi-envelope me-2"></i>Messages</h2>
            </div>

            <div class="admin-card card">
                <div class="card-body p-0">
                    {% for msg in messages %}
                    <a href="{{ url_for('admin.view_message', id=msg.id) }}" class="message-item d-block text-decoration-none {% if not msg.is_read %}unread{% endif %}">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <div class="message-sender text-dark">{{ msg.name }}</div>
                                <div class="text-muted small">{{ msg.email }}</div>
                                {% if msg.subject %}
                                <div class="fw-500 small mt-1">{{ msg.subject }}</div>
                                {% endif %}
                                <div class="text-muted small text-truncate" style="max-width:500px">{{ msg.message[:100] }}{% if msg.message|length > 100 %}...{% endif %}</div>
                            </div>
                            <div class="text-end flex-shrink-0 ms-3">
                                <small class="text-muted">{{ msg.created_at.strftime('%d %b %Y') }}</small>
                                <br>
                                <small class="text-muted">{{ msg.created_at.strftime('%H:%M') }}</small>
                                {% if not msg.is_read %}
                                <br><span class="badge bg-primary mt-1">New</span>
                                {% endif %}
                            </div>
                        </div>
                    </a>
                    {% else %}
                    <div class="text-center py-5">
                        <i class="bi bi-envelope-open display-4 text-muted"></i>
                        <p class="text-muted mt-2">No messages yet</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}